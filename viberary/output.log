2023-07-25 15:32:20,679 - src.api.main - ERROR - Exception on /search [POST]
Traceback (most recent call last):
  File "/opt/bitnami/python/lib/python3.8/site-packages/flask/app.py", line 2528, in wsgi_app
    response = self.full_dispatch_request()
  File "/opt/bitnami/python/lib/python3.8/site-packages/flask/app.py", line 1825, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/opt/bitnami/python/lib/python3.8/site-packages/flask/app.py", line 1823, in full_dispatch_request
    rv = self.dispatch_request()
  File "/opt/bitnami/python/lib/python3.8/site-packages/flask/app.py", line 1799, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
  File "/viberary/src/api/main.py", line 42, in search
    return return_model_results(word)
  File "/viberary/src/api/main.py", line 19, in return_model_results
    data = retriever.top_knn(word)
  File "/viberary/src/search/knn_search.py", line 74, in top_knn
    results = r.ft(self.index).search(q, query_params=params_dict)
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/commands/search/commands.py", line 420, in search
    res = self.execute_command(SEARCH_CMD, *args)
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/client.py", line 1258, in execute_command
    return conn.retry.call_with_retry(
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/retry.py", line 46, in call_with_retry
    return do()
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/client.py", line 1259, in <lambda>
    lambda: self._send_command_parse_response(
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/client.py", line 1235, in _send_command_parse_response
    return self.parse_response(conn, command_name, **options)
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/client.py", line 1275, in parse_response
    response = connection.read_response()
  File "/opt/bitnami/python/lib/python3.8/site-packages/redis/connection.py", line 882, in read_response
    raise response
redis.exceptions.ResponseError: viberary: no such index
2023-07-25 15:34:37,723 - root - INFO - Deleting Redis index viberary...
2023-07-25 15:34:37,741 - root - INFO - Creating dataframe from src/training_data/20230711_learned_embeddings.snappy...
2023-07-25 15:34:52,428 - root - INFO - Loading RecordBatch 0
2023-07-25 15:34:54,081 - root - INFO - Loading RecordBatch 1
2023-07-25 15:34:56,762 - root - INFO - Loading RecordBatch 2
2023-07-25 15:34:58,747 - root - INFO - Loading RecordBatch 3
2023-07-25 15:35:00,017 - root - INFO - Loading RecordBatch 4
2023-07-25 15:35:01,544 - root - INFO - Loading RecordBatch 5
2023-07-25 15:35:03,162 - root - INFO - Loading RecordBatch 6
2023-07-25 15:35:06,161 - root - INFO - Loading RecordBatch 7
2023-07-25 15:35:08,277 - root - INFO - Loading RecordBatch 8
2023-07-25 15:35:09,973 - root - INFO - Loading RecordBatch 9
2023-07-25 15:35:11,471 - root - INFO - Loading RecordBatch 10
2023-07-25 15:35:12,914 - root - INFO - Loading RecordBatch 11
2023-07-25 15:35:14,257 - root - INFO - Loading RecordBatch 12
2023-07-25 15:35:18,355 - root - INFO - Inserting vector into Redis search index viberary
2023-07-25 15:35:18,357 - root - INFO - Inserting 0 vector into Redis index viberary
2023-07-25 15:35:18,379 - root - INFO - Inserting 5000 vector into Redis index viberary
2023-07-25 15:35:18,620 - root - INFO - Inserting 10000 vector into Redis index viberary
2023-07-25 15:35:18,867 - root - INFO - Inserting 15000 vector into Redis index viberary
2023-07-25 15:35:19,166 - root - INFO - Inserting 20000 vector into Redis index viberary
2023-07-25 15:35:19,404 - root - INFO - Inserting 25000 vector into Redis index viberary
2023-07-25 15:35:19,701 - root - INFO - Inserting 30000 vector into Redis index viberary
2023-07-25 15:35:19,994 - root - INFO - Inserting 35000 vector into Redis index viberary
2023-07-25 15:35:20,237 - root - INFO - Inserting 40000 vector into Redis index viberary
2023-07-25 15:35:20,454 - root - INFO - Inserting 45000 vector into Redis index viberary
2023-07-25 15:35:20,668 - root - INFO - Inserting 50000 vector into Redis index viberary
2023-07-25 15:35:20,879 - root - INFO - Inserting 55000 vector into Redis index viberary
2023-07-25 15:35:21,151 - root - INFO - Inserting 60000 vector into Redis index viberary
2023-07-25 15:35:21,443 - root - INFO - Inserting 65000 vector into Redis index viberary
2023-07-25 15:35:21,898 - root - INFO - Inserting 70000 vector into Redis index viberary
2023-07-25 15:35:22,260 - root - INFO - Inserting 75000 vector into Redis index viberary
2023-07-25 15:35:22,781 - root - INFO - Inserting 80000 vector into Redis index viberary
2023-07-25 15:35:23,207 - root - INFO - Inserting 85000 vector into Redis index viberary
2023-07-25 15:35:23,484 - root - INFO - Inserting 90000 vector into Redis index viberary
2023-07-25 15:35:23,758 - root - INFO - Inserting 95000 vector into Redis index viberary
2023-07-25 15:35:24,098 - root - INFO - Inserting 100000 vector into Redis index viberary
2023-07-25 15:35:24,363 - root - INFO - Inserting 105000 vector into Redis index viberary
2023-07-25 15:35:24,684 - root - INFO - Inserting 110000 vector into Redis index viberary
2023-07-25 15:35:24,948 - root - INFO - Inserting 115000 vector into Redis index viberary
2023-07-25 15:35:25,258 - root - INFO - Inserting 120000 vector into Redis index viberary
2023-07-25 15:35:25,495 - root - INFO - Inserting 125000 vector into Redis index viberary
2023-07-25 15:35:25,783 - root - INFO - Inserting 130000 vector into Redis index viberary
2023-07-25 15:35:26,302 - root - INFO - Inserting 135000 vector into Redis index viberary
2023-07-25 15:35:26,699 - root - INFO - Inserting 140000 vector into Redis index viberary
2023-07-25 15:35:27,023 - root - INFO - Inserting 145000 vector into Redis index viberary
2023-07-25 15:35:27,335 - root - INFO - Inserting 150000 vector into Redis index viberary
2023-07-25 15:35:27,593 - root - INFO - Inserting 155000 vector into Redis index viberary
2023-07-25 15:35:27,948 - root - INFO - Inserting 160000 vector into Redis index viberary
2023-07-25 15:35:28,188 - root - INFO - Inserting 165000 vector into Redis index viberary
2023-07-25 15:35:28,436 - root - INFO - Inserting 170000 vector into Redis index viberary
2023-07-25 15:35:28,655 - root - INFO - Inserting 175000 vector into Redis index viberary
2023-07-25 15:35:28,875 - root - INFO - Inserting 180000 vector into Redis index viberary
2023-07-25 15:35:29,117 - root - INFO - Inserting 185000 vector into Redis index viberary
2023-07-25 15:35:29,340 - root - INFO - Inserting 190000 vector into Redis index viberary
2023-07-25 15:35:29,563 - root - INFO - Inserting 195000 vector into Redis index viberary
2023-07-25 15:35:29,776 - root - INFO - Inserting 200000 vector into Redis index viberary
2023-07-25 15:35:30,003 - root - INFO - Inserting 205000 vector into Redis index viberary
2023-07-25 15:35:30,239 - root - INFO - Inserting 210000 vector into Redis index viberary
2023-07-25 15:35:30,476 - root - INFO - Inserting 215000 vector into Redis index viberary
2023-07-25 15:35:30,697 - root - INFO - Inserting 220000 vector into Redis index viberary
2023-07-25 15:35:30,935 - root - INFO - Inserting 225000 vector into Redis index viberary
2023-07-25 15:35:31,202 - root - INFO - Inserting 230000 vector into Redis index viberary
2023-07-25 15:35:31,419 - root - INFO - Inserting 235000 vector into Redis index viberary
2023-07-25 15:35:31,633 - root - INFO - Inserting 240000 vector into Redis index viberary
2023-07-25 15:35:31,850 - root - INFO - Inserting 245000 vector into Redis index viberary
2023-07-25 15:35:32,072 - root - INFO - Inserting 250000 vector into Redis index viberary
2023-07-25 15:35:32,291 - root - INFO - Inserting 255000 vector into Redis index viberary
2023-07-25 15:35:32,511 - root - INFO - Inserting 260000 vector into Redis index viberary
2023-07-25 15:35:32,728 - root - INFO - Inserting 265000 vector into Redis index viberary
2023-07-25 15:35:32,949 - root - INFO - Inserting 270000 vector into Redis index viberary
2023-07-25 15:35:33,201 - root - INFO - Inserting 275000 vector into Redis index viberary
2023-07-25 15:35:33,436 - root - INFO - Inserting 280000 vector into Redis index viberary
2023-07-25 15:35:33,654 - root - INFO - Inserting 285000 vector into Redis index viberary
2023-07-25 15:35:33,870 - root - INFO - Inserting 290000 vector into Redis index viberary
2023-07-25 15:35:34,087 - root - INFO - Inserting 295000 vector into Redis index viberary
2023-07-25 15:35:34,322 - root - INFO - Inserting 300000 vector into Redis index viberary
2023-07-25 15:35:34,548 - root - INFO - Inserting 305000 vector into Redis index viberary
2023-07-25 15:35:34,779 - root - INFO - Inserting 310000 vector into Redis index viberary
2023-07-25 15:35:35,017 - root - INFO - Inserting 315000 vector into Redis index viberary
2023-07-25 15:35:35,286 - root - INFO - Inserting 320000 vector into Redis index viberary
2023-07-25 15:35:35,531 - root - INFO - Inserting 325000 vector into Redis index viberary
2023-07-25 15:35:35,758 - root - INFO - Inserting 330000 vector into Redis index viberary
2023-07-25 15:35:35,986 - root - INFO - Inserting 335000 vector into Redis index viberary
2023-07-25 15:35:36,219 - root - INFO - Inserting 340000 vector into Redis index viberary
2023-07-25 15:35:36,453 - root - INFO - Inserting 345000 vector into Redis index viberary
2023-07-25 15:35:36,731 - root - INFO - Inserting 350000 vector into Redis index viberary
2023-07-25 15:35:37,101 - root - INFO - Inserting 355000 vector into Redis index viberary
2023-07-25 15:35:37,378 - root - INFO - Inserting 360000 vector into Redis index viberary
2023-07-25 15:35:37,708 - root - INFO - Inserting 365000 vector into Redis index viberary
2023-07-25 15:35:37,990 - root - INFO - Inserting 370000 vector into Redis index viberary
2023-07-25 15:35:38,307 - root - INFO - Inserting 375000 vector into Redis index viberary
2023-07-25 15:35:38,596 - root - INFO - Inserting 380000 vector into Redis index viberary
2023-07-25 15:35:38,876 - root - INFO - Inserting 385000 vector into Redis index viberary
2023-07-25 15:35:39,241 - root - INFO - Inserting 390000 vector into Redis index viberary
2023-07-25 15:35:39,524 - root - INFO - Inserting 395000 vector into Redis index viberary
2023-07-25 15:35:39,797 - root - INFO - Inserting 400000 vector into Redis index viberary
2023-07-25 15:35:40,080 - root - INFO - Inserting 405000 vector into Redis index viberary
2023-07-25 15:35:40,441 - root - INFO - Inserting 410000 vector into Redis index viberary
2023-07-25 15:35:40,758 - root - INFO - Inserting 415000 vector into Redis index viberary
2023-07-25 15:35:41,054 - root - INFO - Inserting 420000 vector into Redis index viberary
2023-07-25 15:35:41,330 - root - INFO - Inserting 425000 vector into Redis index viberary
2023-07-25 15:35:41,618 - root - INFO - Inserting 430000 vector into Redis index viberary
2023-07-25 15:35:42,025 - root - INFO - Inserting 435000 vector into Redis index viberary
2023-07-25 15:35:42,296 - root - INFO - Inserting 440000 vector into Redis index viberary
2023-07-25 15:35:42,592 - root - INFO - Inserting 445000 vector into Redis index viberary
2023-07-25 15:35:42,921 - root - INFO - Inserting 450000 vector into Redis index viberary
2023-07-25 15:35:43,361 - root - INFO - Inserting 455000 vector into Redis index viberary
2023-07-25 15:35:43,650 - root - INFO - Inserting 460000 vector into Redis index viberary
2023-07-25 15:35:43,928 - root - INFO - Inserting 465000 vector into Redis index viberary
2023-07-25 15:35:44,307 - root - INFO - Inserting 470000 vector into Redis index viberary
2023-07-25 15:35:44,593 - root - INFO - Inserting 475000 vector into Redis index viberary
2023-07-25 15:35:45,100 - root - INFO - Inserting 480000 vector into Redis index viberary
2023-07-25 15:35:45,376 - root - INFO - Inserting 485000 vector into Redis index viberary
2023-07-25 15:35:45,656 - root - INFO - Inserting 490000 vector into Redis index viberary
2023-07-25 15:35:46,009 - root - INFO - Inserting 495000 vector into Redis index viberary
2023-07-25 15:35:46,291 - root - INFO - Inserting 500000 vector into Redis index viberary
2023-07-25 15:35:46,571 - root - INFO - Inserting 505000 vector into Redis index viberary
2023-07-25 15:35:46,877 - root - INFO - Inserting 510000 vector into Redis index viberary
2023-07-25 15:35:47,165 - root - INFO - Inserting 515000 vector into Redis index viberary
2023-07-25 15:35:47,451 - root - INFO - Inserting 520000 vector into Redis index viberary
2023-07-25 15:35:48,002 - root - INFO - Inserting 525000 vector into Redis index viberary
2023-07-25 15:35:48,307 - root - INFO - Inserting 530000 vector into Redis index viberary
2023-07-25 15:35:48,596 - root - INFO - Inserting 535000 vector into Redis index viberary
2023-07-25 15:35:48,931 - root - INFO - Inserting 540000 vector into Redis index viberary
2023-07-25 15:35:49,221 - root - INFO - Inserting 545000 vector into Redis index viberary
2023-07-25 15:35:49,511 - root - INFO - Inserting 550000 vector into Redis index viberary
2023-07-25 15:35:49,794 - root - INFO - Inserting 555000 vector into Redis index viberary
2023-07-25 15:35:50,112 - root - INFO - Inserting 560000 vector into Redis index viberary
2023-07-25 15:35:50,518 - root - INFO - Inserting 565000 vector into Redis index viberary
2023-07-25 15:35:50,863 - root - INFO - Inserting 570000 vector into Redis index viberary
2023-07-25 15:35:51,415 - root - INFO - Inserting 575000 vector into Redis index viberary
2023-07-25 15:35:51,728 - root - INFO - Inserting 580000 vector into Redis index viberary
2023-07-25 15:35:52,071 - root - INFO - Inserting 585000 vector into Redis index viberary
2023-07-25 15:35:52,367 - root - INFO - Inserting 590000 vector into Redis index viberary
2023-07-25 15:35:52,681 - root - INFO - Inserting 595000 vector into Redis index viberary
2023-07-25 15:35:52,981 - root - INFO - Inserting 600000 vector into Redis index viberary
2023-07-25 15:35:53,285 - root - INFO - Inserting 605000 vector into Redis index viberary
2023-07-25 15:35:53,657 - root - INFO - Inserting 610000 vector into Redis index viberary
2023-07-25 15:35:54,311 - root - INFO - Inserting 615000 vector into Redis index viberary
2023-07-25 15:35:54,932 - root - INFO - Inserting 620000 vector into Redis index viberary
2023-07-25 15:35:55,570 - root - INFO - Inserting 625000 vector into Redis index viberary
2023-07-25 15:35:56,344 - root - INFO - Inserting 630000 vector into Redis index viberary
2023-07-25 15:35:56,650 - root - INFO - Inserting 635000 vector into Redis index viberary
2023-07-25 15:35:56,931 - root - INFO - Inserting 640000 vector into Redis index viberary
2023-07-25 15:35:57,213 - root - INFO - Inserting 645000 vector into Redis index viberary
2023-07-25 15:35:57,685 - root - INFO - Inserting 650000 vector into Redis index viberary
2023-07-25 15:35:58,347 - root - INFO - Inserting 655000 vector into Redis index viberary
2023-07-25 15:35:58,982 - root - INFO - Inserting 660000 vector into Redis index viberary
2023-07-25 15:35:59,431 - root - INFO - Inserting 665000 vector into Redis index viberary
2023-07-25 15:35:59,757 - root - INFO - Inserting 670000 vector into Redis index viberary
2023-07-25 15:36:00,742 - root - INFO - Inserting 675000 vector into Redis index viberary
2023-07-25 15:36:01,301 - root - INFO - Inserting 680000 vector into Redis index viberary
2023-07-25 15:36:01,641 - root - INFO - Inserting 685000 vector into Redis index viberary
2023-07-25 15:36:02,063 - root - INFO - Inserting 690000 vector into Redis index viberary
2023-07-25 15:36:02,369 - root - INFO - Inserting 695000 vector into Redis index viberary
2023-07-25 15:36:02,628 - root - INFO - Inserting 700000 vector into Redis index viberary
2023-07-25 15:36:03,006 - root - INFO - Inserting 705000 vector into Redis index viberary
2023-07-25 15:36:03,617 - root - INFO - Inserting 710000 vector into Redis index viberary
2023-07-25 15:36:04,550 - root - INFO - Inserting 715000 vector into Redis index viberary
2023-07-25 15:36:04,882 - root - INFO - Inserting 720000 vector into Redis index viberary
2023-07-25 15:36:05,232 - root - INFO - Inserting 725000 vector into Redis index viberary
2023-07-25 15:36:05,518 - root - INFO - Inserting 730000 vector into Redis index viberary
2023-07-25 15:36:05,816 - root - INFO - Inserting 735000 vector into Redis index viberary
2023-07-25 15:36:06,165 - root - INFO - Inserting 740000 vector into Redis index viberary
2023-07-25 15:36:06,603 - root - INFO - Inserting 745000 vector into Redis index viberary
2023-07-25 15:36:06,939 - root - INFO - Inserting 750000 vector into Redis index viberary
2023-07-25 15:36:07,278 - root - INFO - Inserting 755000 vector into Redis index viberary
2023-07-25 15:36:07,630 - root - INFO - Inserting 760000 vector into Redis index viberary
2023-07-25 15:36:07,933 - root - INFO - Inserting 765000 vector into Redis index viberary
2023-07-25 15:36:08,274 - root - INFO - Inserting 770000 vector into Redis index viberary
2023-07-25 15:36:08,577 - root - INFO - Inserting 775000 vector into Redis index viberary
2023-07-25 15:36:08,874 - root - INFO - Inserting 780000 vector into Redis index viberary
2023-07-25 15:36:09,214 - root - INFO - Inserting 785000 vector into Redis index viberary
2023-07-25 15:36:09,604 - root - INFO - Inserting 790000 vector into Redis index viberary
2023-07-25 15:36:11,140 - root - INFO - Inserting 795000 vector into Redis index viberary
2023-07-25 15:36:11,639 - root - INFO - Inserting 800000 vector into Redis index viberary
2023-07-25 15:36:12,148 - root - INFO - Inserting 805000 vector into Redis index viberary
2023-07-25 15:36:12,501 - root - INFO - Inserting 810000 vector into Redis index viberary
2023-07-25 15:36:12,816 - root - INFO - Inserting 815000 vector into Redis index viberary
2023-07-25 15:36:13,209 - root - INFO - Inserting 820000 vector into Redis index viberary
2023-07-25 15:36:13,567 - root - INFO - Inserting 825000 vector into Redis index viberary
2023-07-25 15:36:13,886 - root - INFO - Inserting 830000 vector into Redis index viberary
2023-07-25 15:36:14,214 - root - INFO - Inserting 835000 vector into Redis index viberary
2023-07-25 15:36:14,524 - root - INFO - Inserting 840000 vector into Redis index viberary
2023-07-25 15:36:15,381 - root - INFO - Creating redis schema...
2023-07-25 15:36:15,382 - root - INFO - using vector, FLOAT64, 768
2023-07-25 15:36:15,383 - root - INFO - using (<redis.commands.search.field.VectorField object at 0x7fffe297cdc0>, <redis.commands.search.field.TextField object at 0x7fffff2f4370>, <redis.commands.search.field.TextField object at 0x7fffff389d90>, <redis.commands.search.field.TextField object at 0x7fffe265d460>, <redis.commands.search.field.TextField object at 0x7fffe26b5b50>)
2023-07-25 15:36:15,459 - root - INFO - Creating Redis schema: (<redis.commands.search.field.VectorField object at 0x7fffe297cdc0>, <redis.commands.search.field.TextField object at 0x7fffff2f4370>, <redis.commands.search.field.TextField object at 0x7fffff389d90>, <redis.commands.search.field.TextField object at 0x7fffe265d460>, <redis.commands.search.field.TextField object at 0x7fffe26b5b50>) in index viberary
2023-07-25 15:36:15,578 - root - INFO - name: viberary, docs: 5931, time:175.07900000000001 ms
